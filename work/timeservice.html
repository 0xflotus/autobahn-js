<!DOCTYPE html>
<html>
   <body>
      <h1>AutobahnJS Timeservice RPC Client</h1>
      <p>
         Current time from Timeservice: <span id="now"></span>
      </p>
      <script src="autobahn.bundle.js"></script>
      <script>
         var session = new autobahn.Session();

         session.onopen = function () {
            // WAMP session established

            function utcnow() {
               console.log("Someone is calling me;)");
               now = new Date();
               return now.toISOString();
            }

            if (true) {
               this.register(utcnow, 'com.timeservice.now').then(
                  function (registration) {
                     console.log("Registered!", registration.id);
                  },
                  function (error) {
                     console.log("Registration failed!", error);
                  }
               );
            }

            function onevent(i) {
               console.log("Got event:", i);
            }

            if (true) {
               this.subscribe(onevent, 'com.myapp.topic1').then(
                  function (subscription) {
                     console.log("Subscribed!", subscription.id);
                  },
                  function (error) {
                     console.log("Subscription failed!", error);
                  }
               );
            }

            if (false) {
               this.call('com.timeservice.now').then(
                  function (now) {
                     document.getElementById("now").innerHTML = now;
                  },
                  function (error) {
                     console.log("RPC Error:", error);
                  }
               );
            }
         };

         session.onclose = function () {
            // WAMP session closed
         };

         var transport = autobahn.WebSocket(true, 'ws://127.0.0.1:9000/', ['wamp.2.json']);

         session.connect(transport);
      </script>
   </body>
</html>
