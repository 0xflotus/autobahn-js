<!DOCTYPE html>
<html>
   <body>
      <h1>AutobahnJS Timeservice RPC Client</h1>
      <p>
         Current time from Timeservice: <span id="now"></span>
      </p>
      <script src="autobahn.bundle.js"></script>
      <script>
         var transport = new autobahn.Transport();
         //transport.add(new autobahn.WebSocket('ws://127.0.0.1:9000/', ['wamp.2.json']));

         var session = new autobahn.Session();

         session.onconnect = function () {
            this.join("realm1");
         }

         session.onjoin = function () {
            // WAMP session established

            function utcnow() {
               console.log("Someone is calling me;)");
               now = new Date();
               return now.toISOString();
            }

            if (false) {
               this.register(utcnow, 'com.timeservice.now').then(
                  function (registration) {
                     console.log("Registered!", registration.id);
                  },
                  function (error) {
                     console.log("Registration failed!", error);
                  }
               );
            }

            function onevent(i) {
               console.log("Got event:", i);
            }

            if (false) {
               this.subscribe(onevent, 'com.myapp.topic1').then(
                  function (subscription) {
                     console.log("Subscribed!", subscription.id);
                  },
                  function (error) {
                     console.log("Subscription failed!", error);
                  }
               );
            }

            if (true) {
               this.call('com.timeservice.now').then(
                  function (now) {
                     document.getElementById("now").innerHTML = now;
                     session.leave();
                  },
                  function (error) {
                     console.log("RPC Error:", error);
                  }
               );
            }
         };

         session.onleave = function () {
            console.log("WAMP session closed");
            this.disconnect();
         };

         session.ondisconnect = function () {
            console.log("transport closed");
         };

         var transport1 = autobahn.WebSocket('ws://127.0.0.1:9000/', ['wamp.2.json']);

         session.connect(transport1);
      </script>
   </body>
</html>
